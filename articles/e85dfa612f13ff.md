---
title: "[Flutter]ListItemãŒè¦‹ãˆãªããªã£ã¦ã‚‚ä¸€æ™‚çš„ã«çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹æ–¹æ³•"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["flutter", "dart", "performance"]
published: false
---

## ã¯ã˜ã‚ã«

ListViewã®ListItemãŒè¦‹ãˆãªããªã£ã¦ã‚‚çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## èƒŒæ™¯

ListViewã®ListItemã«ã¯è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã®ã†ã¡ã€ä¸€éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¦è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚
ã—ã‹ã—ã€ä¸€ã¤ãšã¤ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã‚ˆã‚Šã‚‚ã€ListItemå´ã§Providerã‚’(ã§ãã‚Œã°selectorã‚’ä½¿ã£ã¦)å–å¾—ã—ã¦è¡¨ç¤ºã—ãŸã„ã“ã¨ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚IDã ã‘æ¸¡ã—ã¦ã€ListItemå´ã§Providerã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã­ã€‚

ãŸã ã€ListViewã®ListItemã¯è¦‹ãˆãªããªã‚‹ã¨ç ´æ£„ã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é »ç¹ã«è¡Œã†ã¨ã€ListItemãŒç ´æ£„ã•ã‚Œã¦å†åº¦è¡¨ç¤ºã•ã‚Œã‚‹ãŸã³ã«Providerã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ç›´ã™ã“ã¨ã«ãªã‚Šã¾ã™ã€‚Providerã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒé‡ã„å ´åˆã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿ãŒå‡ºã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ListItemãŒè¦‹ãˆãªããªã£ã¦ã‚‚çŠ¶æ…‹ã‚’ä¸€æ™‚çš„ã«ç¶­æŒã§ãã‚Œã°ã€Providerã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚

ã¨ã„ã†ã“ã¨ã§ã€ãã®ListViewã®ListItemãŒè¦‹ãˆãªããªã£ã¦ã‚‚çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ã‚„ã‚Šæ–¹

çµè«–ã‹ã‚‰è¨€ã†ã¨ `AutomaticKeepAliveClientMixin` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### AutomaticKeepAliveClientMixinã®ä½¿ã„æ–¹

```dart
import 'dart:async';

class MyListItem extends StatefulWidget {
  const MyListItem({super.key});

  @override
  State<MyListItem> createState() => _MyListItemState();
}

class _MyListItemState extends State<MyListItem> with AutomaticKeepAliveClientMixin {
  var _counter = 0;

  // çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã‹ã©ã†ã‹ã‚’è¿”ã™
  @override
  bool get wantKeepAlive => true;

  @override
  Widget build(BuildContext context) {
    super.build(context);
    return ListTile(
      title: Text('Counter: $_counter'),
      onTap: () {
        setState(() {
          _counter++;
        });
      },
    );
  }
}
```

ã“ã‚Œã§å¿…ãšListItemãŒè¦‹ãˆãªããªã£ã¦ã‚‚çŠ¶æ…‹ã‚’ç¶­æŒã—ã¾ã™ã€‚
ãŸã ã€ã“ã†ã—ãŸä½¿ã„æ–¹ã‚’ã™ã‚‹ã“ã¨ã¯ãªã„ã¨æ€ã„ã¾ã™ï¼ˆãšã£ã¨çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã«ãªã£ã¦ã—ã¾ã†ã®ã§ï¼‰ã€‚

ã¨ã„ã†ã“ã¨ã§å…·ä½“çš„ã«ã‚ã‚Šãã†ãªã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚

### ã‚¿ãƒƒãƒ—ã—ã¦ã‹ã‚‰ä¸€å®šæ™‚é–“ã ã‘çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹

ä¾‹ãˆã°ã€ListItemã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‹ã‚‰5ç§’é–“ã ã‘çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```dart
import 'dart:async';

class TimedKeepAliveListItem extends StatefulWidget {
  const TimedKeepAliveListItem({super.key});

  @override
  State<TimedKeepAliveListItem> createState() => _TimedKeepAliveListItemState();
}

class _TimedKeepAliveListItemState extends State<TimedKeepAliveListItem>
    with AutomaticKeepAliveClientMixin {
  var _counter = 0;
  bool _shouldKeepAlive = false;
  Timer? _keepAliveTimer;

  @override
  bool get wantKeepAlive => _shouldKeepAlive;

  void _startKeepAlive() {
    setState(() {
      _shouldKeepAlive = true;
    });

    // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    _keepAliveTimer?.cancel();

    // 5ç§’å¾Œã«çŠ¶æ…‹ç¶­æŒã‚’åœæ­¢
    _keepAliveTimer = Timer(const Duration(seconds: 5), () {
      setState(() {
        _shouldKeepAlive = false;
      });
      updateKeepAlive();
    });

    updateKeepAlive();
  }


  @override
  void dispose() {
    _keepAliveTimer?.cancel();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    super.build(context);
    return ListTile(
      title: Text('Counter: $_counter ${_shouldKeepAlive ? "(ä¿æŒä¸­)" : ""}'),
      onTap: () {
        setState(() {
          _counter++;
        });
        _startKeepAlive();
      },
    );
  }
}
```

## ãŠã‚ã‚Šã«
